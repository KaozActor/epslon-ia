<!DOCTYPE html>
<html>
<head>
    <title>IA do Evento RPG (Generativa Aprimorada)</title>
    <style>
        body { font-family: sans-serif; }
        #chat { width: 600px; margin: 20px auto; border: 1px solid #ccc; padding: 10px; }
        #input-area { margin-bottom: 10px; }
        #resposta-area { padding: 10px; border-top: 1px solid #ccc; }
        #resposta { word-wrap: break-word; }
        input[type="text"] { width: 80%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; }
        button { padding: 8px 15px; background-color: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background-color: #3e8e41; }
    </style>
</head>
<body>
    <div id="chat">
        <h1>IA do Evento RPG</h1>
        <div id="input-area">
            <input type="text" id="pergunta" placeholder="Faça sua pergunta">
            <button onclick="enviarPergunta()">Enviar</button>
        </div>
        <div id="resposta-area">
            <p id="resposta">Olá! Sou a IA do evento. Faça uma pergunta.</p>
        </div>
    </div>

    <script>
        const planilhaURL = 'SEU_LINK_DA_PLANILHA'; // Substitua aqui!

        const frases = {
            introducao: [
                "Hum, deixe-me ver...",
                "Sobre isso...",
                "Interessante questão!",
                "Posso te dizer que...",
                "Deixe-me pensar um pouco...",
                "Ah, sim, sobre isso..."
            ],
            conclusao: [
                "Espero ter ajudado!",
                "Essa é a informação que tenho.",
                "É tudo que sei.",
                "Espero que isso ajude em sua jornada!",
                "Se precisar de mais algo, me diga."
            ],
            desconhecido: [
                "Não tenho essa informação no momento.",
                "Não sei responder a essa pergunta.",
                "Essa informação me escapa."
            ]
        };

        function enviarPergunta() {
            const pergunta = document.getElementById('pergunta').value.toLowerCase();
            const respostaArea = document.getElementById('resposta');
            respostaArea.textContent = 'Carregando...';

            fetch(planilhaURL)
                .then(response => response.text())
                .then(data => {
                    const linhas = data.split('\n');
                    const bancoDeDados = [];

                    for (let i = 1; i < linhas.length; i++) { // Começa em 1 para ignorar o cabeçalho
                        const colunas = linhas[i].split(',');
                        if (colunas.length >= 3) {
                            bancoDeDados.push({
                                entidade: colunas[0].toLowerCase().trim(),
                                atributo: colunas[1].toLowerCase().trim(),
                                valores: colunas[2].trim().split(';').map(v => v.trim()),
                            });
                        }
                    }

                    let resposta = frases.desconhecido[Math.floor(Math.random() * frases.desconhecido.length)];
                    const palavrasChave = pergunta.split(' ');
                    let entidadeEncontrada = null;
                    let atributoEncontrado = null;

                    // Busca por entidades e atributos que correspondam a pergunta
                    for (const item of bancoDeDados) {
                         if (palavrasChave.some(palavra => item.entidade.includes(palavra) || item.atributo.includes(palavra))) {
                            entidadeEncontrada = item.entidade;
                            atributoEncontrado = item.atributo;
                            break;
                        }
                    }


                    if (entidadeEncontrada && atributoEncontrado) {
                        // Tenta responder com base nas palavras-chave
                        for (const item of bancoDeDados) {
                            if (item.entidade === entidadeEncontrada && item.atributo === atributoEncontrado) {
                                const valor = item.valores[Math.floor(Math.random() * item.valores.length)];
                                let frase = '';

                                if (pergunta.includes(item.entidade) && pergunta.includes(item.atributo)) {
                                    frase = `${item.entidade} tem ${item.atributo} que é ${valor}.`;
                                } else if (pergunta.includes(item.entidade)) {
                                    frase = `${item.entidade} ${item.atributo} é ${valor}.`;
                                } else if (pergunta.includes(item.atributo)) {
                                    frase = `O ${item.atributo} de ${item.entidade} é ${valor}.`; // Mais natural
                                }

                                const introducao = frases.introducao[Math.floor(Math.random() * frases.introducao.length)];
                                const conclusao = frases.conclusao[Math.floor(Math.random() * frases.conclusao.length)];
                                resposta = `${introducao} ${frase} ${conclusao}`;
                                break; // Encontrou, então para
                            }
                        }
                    }

                    respostaArea.textContent = resposta;
                })
                .catch(error => {
                    respostaArea.textContent = 'Erro ao obter resposta.';
                    console.error('Erro:', error);
                });
        }
    </script>
</body>
</html>
